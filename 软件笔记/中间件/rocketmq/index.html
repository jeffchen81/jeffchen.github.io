<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../img/favicon.ico">
        <title>RocketMQ 分布式MQ和流平台 - 初始文明路</title>
        <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="../../..">初始文明路</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="../../..">首页</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">参考手册 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../参考手册/markdown/">Markdown语法</a>
</li>
                                    
<li >
    <a href="../../../参考手册/svn/">SVN 版本管理</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">软件笔记 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../mkdocs/">MkDocs 静态网页生成</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Js库</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../js库/iview-admin/">基于Vue的后台管理系统前端UI方案</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Linux工具</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../linux工具/mutt/">Mutt 命令行邮件客户端</a>
</li>
            
<li >
    <a href="../../linux工具/ops_bash/">常用运维命令</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Py库</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../py库/spiff_workflow/">SpiffWorkflow 工作流引擎</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">中间件</a>
    <ul class="dropdown-menu">
            
<li class="active">
    <a href="./">RocketMQ 分布式MQ和流平台</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">运维研发 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../运维研发/">简介</a>
</li>
                                    
<li >
    <a href="../../../运维研发/alarm/">告警服务</a>
</li>
                                    
<li >
    <a href="../../../运维研发/env_build/">Env build</a>
</li>
                                    
<li >
    <a href="../../../运维研发/monitor/">监控体系</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="../../py库/spiff_workflow/">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../../../运维研发/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#rocketmq-mq">RocketMQ 分布式MQ和流平台</a></li>
            <li><a href="#_1">简介</a></li>
            <li><a href="#docker">安装（docker版）</a></li>
            <li><a href="#_2">核心</a></li>
            <li><a href="#cli">使用（CLI）</a></li>
            <li><a href="#_4">参考</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="rocketmq-mq">RocketMQ 分布式MQ和流平台</h1>
<h2 id="_1">简介</h2>
<ul>
<li>开源，Apache2.0</li>
<li>Pull模式</li>
<li>低延时，亿级</li>
<li>高可靠，磁盘数据固化</li>
<li>易扩容</li>
<li>支持Scheduled</li>
<li>支持广播</li>
<li>支持条件过滤</li>
</ul>
<h2 id="docker">安装（docker版）</h2>
<p><strong>安装需求</strong>：</p>
<ul>
<li>64位，类Unix系统</li>
<li>JDK 1.8以上</li>
<li>Broker节点需要4G以上硬盘</li>
</ul>
<pre><code>git clone https://github.com/apache/rocketmq-externals.git
cd rocketmq-externals/rocketmq-docker/4.4.0
./play-docker.sh  # 编译并启动镜像，非常简单人性化
# 测试生产者
docker exec -ti rmqbroker sh ./tools.sh org.apache.rocketmq.example.quickstart.Producer
# 测试消费
docker exec -ti rmqbroker sh ./tools.sh org.apache.rocketmq.example.quickstart.Consumer
</code></pre>

<p><strong>启动参数</strong>：</p>
<ul>
<li><code>-e "MAX_POSSIBLE_HEAP=100000000"</code>指定jvm内存heap</li>
</ul>
<p>运行效果:
<img alt="运行效果" src="../rocketmq.png" /></p>
<p><strong>优雅关机</strong>：</p>
<ul>
<li>
<p><code>docker exec -ti rmqbroker sh ./mqshutdown broker</code>先关broker</p>
<blockquote>
<pre><code>The mqbroker(28) is running...
Send shutdown request to mqbroker(28) OK
</code></pre>
</blockquote>
</li>
<li>
<p><code>docker exec -ti rmqnamesrv sh ./mqshutdown namesrv</code>再关namesrv</p>
<blockquote>
<pre><code>The mqnamesrv(27) is running...
Send shutdown request to mqnamesrv(27) OK
</code></pre>
</blockquote>
</li>
</ul>
<h2 id="_2">核心</h2>
<h3 id="_3">架构图</h3>
<p><img alt="架构" src="../rmq-basic-arc.png" /></p>
<h2 id="cli">使用（CLI）</h2>
<p>用法：<code>bin/mqadmin &lt;命令&gt; &lt;参数&gt;</code></p>
<p>命令如下：</p>
<blockquote>
<pre><code>updateTopic          Update or create topic
deleteTopic          Delete topic from broker and NameServer.
updateSubGroup       Update or create subscription group
deleteSubGroup       Delete subscription group from broker.
updateBrokerConfig   Update broker's config
updateTopicPerm      Update topic perm
topicRoute           Examine topic route info
topicStatus          Examine topic Status info
topicClusterList     get cluster info for topic
brokerStatus         Fetch broker runtime status data
queryMsgById         Query Message by Id
queryMsgByKey        Query Message by Key
queryMsgByUniqueKey  Query Message by Unique key
queryMsgByOffset     Query Message by offset
printMsg             Print Message Detail
printMsgByQueue      Print Message Detail
sendMsgStatus        send msg to broker.
brokerConsumeStats   Fetch broker consume stats data
producerConnection   Query producer's socket connection and client version
consumerConnection   Query consumer's socket connection, client version and subscription
consumerProgress     Query consumers's progress, speed
consumerStatus       Query consumer's internal data structure
cloneGroupOffset     clone offset from other group.
clusterList          List all of clusters
topicList            Fetch all topic list from name server
updateKvConfig       Create or update KV config.
deleteKvConfig       Delete KV config.
wipeWritePerm        Wipe write perm of broker in all name server
resetOffsetByTime    Reset consumer offset by timestamp(without client restart).
updateOrderConf      Create or update or delete order conf
cleanExpiredCQ       Clean expired ConsumeQueue on broker.
cleanUnusedTopic     Clean unused topic on broker.
startMonitoring      Start Monitoring
statsAll             Topic and Consumer tps stats
allocateMQ           Allocate MQ
checkMsgSendRT       check message send response time
clusterRT            List All clusters Message Send RT
getNamesrvConfig     Get configs of name server.
updateNamesrvConfig  Update configs of name server.
getBrokerConfig      Get broker config by cluster or special broker!
queryCq              Query cq command.
sendMessage          Send a message
consumeMessage       Consume message
</code></pre>
</blockquote>
<h2 id="_4">参考</h2>
<ul>
<li><a href="https://rocketmq.apache.org/">官网</a></li>
<li><a href="https://github.com/apache/rocketmq/">github源码</a></li>
<li><a href="https://github.com/apache/rocketmq-externals/tree/master/rocketmq-docker">官方docker</a></li>
<li><a href="https://github.com/apache/rocketmq-client-python">官方Python客户端</a></li>
</ul></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../../..",
                shortcuts = {"search": 83, "next": 78, "help": 191, "previous": 80};
        </script>
        <script src="../../../js/base.js" defer></script>
        <script src="../../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
